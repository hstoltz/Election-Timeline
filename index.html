<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U.S. Presidential Election Timeline</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d0d0d;
            --bg-secondary: #161616;
            --bg-tertiary: #1f1f1f;
            --text-primary: #e8e6e3;
            --text-secondary: #a09c97;
            --text-muted: #6b6762;
            --accent-blue: #4a9eff;
            --accent-gold: #d4a84b;
            --crisis-red: #e63946;
            --crisis-red-dim: #8b2430;
            --reform-green: #2a9d8f;
            --pressure-orange: #f4a261;
            --border-color: #2a2a2a;
            --timeline-track: #333;

            /* Lane colors */
            --lane-official: #2a9d8f;
            --lane-legal: #4a9eff;
            --lane-political: #d4a84b;
            --lane-pressure: #f4a261;
            --lane-violence: #e63946;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Sans 3', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        header {
            border-bottom: 1px solid var(--border-color);
            padding: 2rem 0;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .eyebrow {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--accent-gold);
            margin-bottom: 0.5rem;
        }

        h1 {
            font-family: 'Libre Baskerville', Georgia, serif;
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 400;
            line-height: 1.1;
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 700px;
            font-weight: 300;
        }

        /* Controls */
        .controls {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .controls-inner {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .control-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        /* Toggle Switch */
        .toggle-container {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 4px;
            border: 1px solid var(--border-color);
        }

        .toggle-btn {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .toggle-btn.active {
            background: var(--accent-gold);
            color: var(--bg-primary);
            font-weight: 500;
        }

        .toggle-btn:hover:not(.active) {
            color: var(--text-primary);
        }

        /* Crisis Toggle Button */
        .crisis-btn {
            font-family: 'Source Sans 3', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.6rem 1.25rem;
            border: 2px solid var(--crisis-red-dim);
            background: transparent;
            color: var(--crisis-red);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .crisis-btn:hover {
            background: var(--crisis-red-dim);
            border-color: var(--crisis-red);
        }

        .crisis-btn.active {
            background: var(--crisis-red);
            border-color: var(--crisis-red);
            color: white;
        }

        .crisis-btn::before {
            content: '';
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            transition: all 0.25s ease;
        }

        .crisis-btn.active::before {
            box-shadow: 0 0 12px var(--crisis-red);
        }

        /* Connections Toggle Button */
        .connections-btn {
            font-family: 'Source Sans 3', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.6rem 1.25rem;
            border: 2px solid var(--border-color);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .connections-btn:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .connections-btn.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
        }

        .connections-btn::before {
            content: '';
            width: 16px;
            height: 2px;
            background: currentColor;
            border-radius: 1px;
            position: relative;
        }

        .connections-btn::after {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            position: absolute;
            left: 1.25rem;
        }

        /* Zoom Controls */
        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
        }

        .zoom-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .zoom-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
            border-color: var(--text-muted);
        }

        .zoom-level {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-muted);
            min-width: 50px;
            text-align: center;
        }

        /* Main Content */
        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Phase Navigation */
        .phase-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .phase-btn {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.05em;
            padding: 0.4rem 0.75rem;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.2s ease;
        }

        .phase-btn:hover, .phase-btn.active {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        /* Timeline Container */
        .timeline-wrapper {
            position: relative;
            overflow-x: auto;
            overflow-y: visible;
            padding-bottom: 2rem;
            margin-bottom: 2rem;
        }

        .timeline-container {
            position: relative;
            min-height: 700px;
            padding-top: 80px;
        }

        /* Timeline Track - now shows multiple lane tracks */
        .timeline-track {
            position: absolute;
            top: 30px;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--timeline-track);
            border-radius: 2px;
            display: none; /* Hidden - using lane tracks instead */
        }

        /* Lane System */
        .lane-tracks {
            position: absolute;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .lane-track {
            position: absolute;
            left: 100px;
            right: 50px;
            height: 2px;
            opacity: 0.3;
            border-radius: 1px;
        }

        .lane-track.official { background: var(--lane-official); top: 0; }
        .lane-track.legal { background: var(--lane-legal); top: 100px; }
        .lane-track.political { background: var(--lane-political); top: 200px; }
        .lane-track.pressure { background: var(--lane-pressure); top: 300px; }
        .lane-track.violence { background: var(--lane-violence); top: 400px; }

        .lane-label {
            position: absolute;
            left: 0;
            width: 90px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            letter-spacing: 0.02em;
            text-transform: uppercase;
            transform: translateY(-50%);
            text-align: right;
            padding-right: 10px;
        }

        .lane-label.official { top: 60px; color: var(--lane-official); }
        .lane-label.legal { top: 160px; color: var(--lane-legal); }
        .lane-label.political { top: 260px; color: var(--lane-political); }
        .lane-label.pressure { top: 360px; color: var(--lane-pressure); }
        .lane-label.violence { top: 460px; color: var(--lane-violence); }

        /* Connection Lines SVG */
        .connections-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .connection-line {
            fill: none;
            stroke-width: 2;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .show-connections .connection-line {
            opacity: 0.4;
        }

        .connection-line.highlighted {
            opacity: 0.9;
            stroke-width: 3;
        }

        .connection-line.legal-chain { stroke: var(--lane-legal); }
        .connection-line.pressure-chain { stroke: var(--lane-pressure); }
        .connection-line.violence-chain { stroke: var(--lane-violence); }
        .connection-line.political-chain { stroke: var(--lane-political); }

        /* Date Markers */
        .date-markers {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
        }

        .date-marker {
            position: absolute;
            transform: translateX(-50%);
            text-align: center;
        }

        .date-marker-line {
            width: 1px;
            height: 20px;
            background: var(--timeline-track);
            margin: 0 auto 4px;
        }

        .date-marker-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: var(--text-muted);
            white-space: nowrap;
        }

        /* Timeline Events */
        .timeline-event {
            position: absolute;
            transform: translateX(-50%);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .timeline-event:hover {
            z-index: 100;
        }

        .event-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--accent-blue);
            border: 2px solid var(--bg-primary);
            margin: 0 auto 6px;
            transition: all 0.3s ease;
            position: relative;
        }

        .timeline-event:hover .event-dot {
            transform: scale(1.4);
            box-shadow: 0 0 20px currentColor;
        }

        /* Lane-based event dot colors */
        .timeline-event[data-lane="official"] .event-dot { background: var(--lane-official); }
        .timeline-event[data-lane="legal"] .event-dot { background: var(--lane-legal); }
        .timeline-event[data-lane="political"] .event-dot { background: var(--lane-political); }
        .timeline-event[data-lane="pressure"] .event-dot { background: var(--lane-pressure); }
        .timeline-event[data-lane="violence"] .event-dot { background: var(--lane-violence); }

        /* Type-based overrides for backward compatibility */
        .timeline-event.official .event-dot { background: var(--lane-official); }
        .timeline-event.crisis .event-dot { background: var(--crisis-red); }
        .timeline-event.reform .event-dot { background: var(--reform-green); }

        .event-content {
            width: 160px;
            text-align: center;
        }

        .event-date {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-bottom: 3px;
        }

        .event-title {
            font-size: 0.8rem;
            font-weight: 600;
            line-height: 1.25;
            color: var(--text-primary);
        }

        /* Lane-based title colors for crisis events */
        .timeline-event.crisis[data-lane="violence"] .event-title { color: var(--lane-violence); }
        .timeline-event.crisis[data-lane="legal"] .event-title { color: var(--lane-legal); }
        .timeline-event.crisis[data-lane="pressure"] .event-title { color: var(--lane-pressure); }
        .timeline-event.crisis[data-lane="political"] .event-title { color: var(--lane-political); }

        .event-description {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 4px;
            display: none;
        }

        .timeline-event:hover .event-description {
            display: block;
        }

        /* Event connection indicator */
        .event-dot.has-connections::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .show-connections .event-dot.has-connections::after {
            opacity: 0.8;
        }

        /* Lane-based vertical positioning */
        .timeline-event[data-lane="official"] { top: 60px; }
        .timeline-event[data-lane="legal"] { top: 160px; }
        .timeline-event[data-lane="political"] { top: 260px; }
        .timeline-event[data-lane="pressure"] { top: 360px; }
        .timeline-event[data-lane="violence"] { top: 460px; }

        /* Offset classes for collision avoidance */
        .timeline-event.offset-1 { margin-top: -60px; }
        .timeline-event.offset-2 { margin-top: 60px; }
        .timeline-event.offset-3 { margin-top: -30px; }
        .timeline-event.offset-4 { margin-top: 30px; }

        /* Crisis events hidden by default */
        .timeline-event.crisis {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        .show-crisis .timeline-event.crisis {
            opacity: 1;
            pointer-events: auto;
        }

        /* Highlighted events (connected) */
        .timeline-event.highlighted .event-dot {
            transform: scale(1.4);
            box-shadow: 0 0 25px currentColor;
        }

        .timeline-event.highlighted .event-title {
            color: var(--text-primary) !important;
        }

        /* Legend */
        .legend {
            display: flex;
            gap: 2rem;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .legend-section {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .legend-section-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .legend-dot.official { background: var(--lane-official); }
        .legend-dot.procedural { background: var(--accent-blue); }
        .legend-dot.crisis { background: var(--crisis-red); }
        .legend-dot.reform { background: var(--reform-green); }

        .legend-line {
            width: 24px;
            height: 2px;
            background: linear-gradient(90deg, var(--lane-legal), var(--lane-violence));
            border-radius: 1px;
        }

        .legend-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Info Panel */
        .info-panel {
            margin-top: 3rem;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .info-panel h2 {
            font-family: 'Libre Baskerville', serif;
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .info-panel p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            max-width: 800px;
        }

        .info-panel .reform-note {
            padding: 1rem;
            background: rgba(42, 157, 143, 0.1);
            border-left: 3px solid var(--reform-green);
            margin-top: 1rem;
            border-radius: 0 4px 4px 0;
        }

        .info-panel .reform-note strong {
            color: var(--reform-green);
        }

        /* Event Detail Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 2rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .modal-date {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--accent-gold);
            margin-bottom: 0.5rem;
        }

        .modal-title {
            font-family: 'Libre Baskerville', serif;
            font-size: 1.3rem;
            font-weight: 400;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-body p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .modal-tag {
            display: inline-block;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            margin-top: 0.5rem;
        }

        .modal-tag.crisis {
            background: rgba(230, 57, 70, 0.2);
            color: var(--crisis-red);
        }

        .modal-tag.official {
            background: rgba(212, 168, 75, 0.2);
            color: var(--accent-gold);
        }

        .modal-tag.reform {
            background: rgba(42, 157, 143, 0.2);
            color: var(--reform-green);
        }

        .modal-tag.legal {
            background: rgba(74, 158, 255, 0.2);
            color: var(--lane-legal);
        }

        .modal-tag.political {
            background: rgba(212, 168, 75, 0.2);
            color: var(--lane-political);
        }

        .modal-tag.pressure {
            background: rgba(244, 162, 97, 0.2);
            color: var(--lane-pressure);
        }

        .modal-tag.violence {
            background: rgba(230, 57, 70, 0.2);
            color: var(--lane-violence);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .controls-inner {
                flex-direction: column;
                align-items: flex-start;
            }

            .zoom-controls {
                margin-left: 0;
            }

            .timeline-container {
                min-height: 550px;
            }

            .event-content {
                width: 120px;
            }

            .event-title {
                font-size: 0.7rem;
            }

            .lane-label {
                font-size: 0.55rem;
                width: 70px;
            }

            .legend {
                flex-direction: column;
                gap: 1rem;
            }

            .legend-items {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        /* Scrollbar styling */
        .timeline-wrapper::-webkit-scrollbar {
            height: 8px;
        }

        .timeline-wrapper::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .timeline-wrapper::-webkit-scrollbar-thumb {
            background: var(--timeline-track);
            border-radius: 4px;
        }

        .timeline-wrapper::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="eyebrow">Interactive Timeline</div>
            <h1>The Presidential Election Process</h1>
            <p class="subtitle">From Election Day to Inauguration: understanding the constitutional framework, the 2020 crisis, and post-reform safeguards.</p>
        </div>
    </header>

    <div class="controls">
        <div class="controls-inner">
            <div class="control-group">
                <span class="control-label">Election Year</span>
                <div class="toggle-container">
                    <button class="toggle-btn active" data-year="2020">2020</button>
                    <button class="toggle-btn" data-year="2028">2028</button>
                </div>
            </div>

            <div class="control-group">
                <button class="crisis-btn" id="crisisToggle">
                    Show 2020 Crisis Events
                </button>
            </div>

            <div class="control-group">
                <button class="connections-btn" id="connectionsToggle">
                    Show Connections
                </button>
            </div>

            <div class="zoom-controls">
                <span class="control-label">Zoom</span>
                <button class="zoom-btn" id="zoomOut">−</button>
                <span class="zoom-level" id="zoomLevel">100%</span>
                <button class="zoom-btn" id="zoomIn">+</button>
            </div>
        </div>
    </div>

    <main>
        <div class="phase-nav">
            <button class="phase-btn active" data-phase="all">All Phases</button>
            <button class="phase-btn" data-phase="pre">Pre-Election</button>
            <button class="phase-btn" data-phase="election">Election Day</button>
            <button class="phase-btn" data-phase="certification">Certification</button>
            <button class="phase-btn" data-phase="electoral">Electoral College</button>
            <button class="phase-btn" data-phase="congress">Congressional Count</button>
            <button class="phase-btn" data-phase="transition">Transition</button>
        </div>

        <div class="timeline-wrapper">
            <div class="timeline-container" id="timeline">
                <div class="timeline-track"></div>
                <div class="date-markers" id="dateMarkers"></div>
                <!-- Events will be dynamically inserted -->
            </div>
        </div>

        <div class="legend">
            <div class="legend-section">
                <div class="legend-section-title">Event Categories (Lanes)</div>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--lane-official);"></div>
                        <span class="legend-label">Official Deadlines</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--lane-legal);"></div>
                        <span class="legend-label">Legal Challenges</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--lane-political);"></div>
                        <span class="legend-label">Political/Institutional</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--lane-pressure);"></div>
                        <span class="legend-label">Pressure Campaigns</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--lane-violence);"></div>
                        <span class="legend-label">Violence & Threats</span>
                    </div>
                </div>
            </div>
            <div class="legend-section">
                <div class="legend-section-title">Special Markers</div>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-dot reform"></div>
                        <span class="legend-label">ECRA 2022 Reforms</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line"></div>
                        <span class="legend-label">Event Connections (toggle to show)</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-panel" id="infoPanel">
            <h2>How Presidential Elections Work</h2>
            <p>The U.S. presidential election process spans approximately 78 days from Election Day to Inauguration. During this period, votes are counted, results are certified by states, electors cast their ballots, and Congress formally counts the electoral votes.</p>
            <p>Each step has legal deadlines and procedures—and each represents a potential pressure point where the normal process can be challenged or disrupted.</p>
            <div class="reform-note" id="reformNote" style="display: none;">
                <strong>Electoral Count Reform Act of 2022:</strong> After the 2020 election crisis, Congress passed the ECRA to close loopholes exploited in the attempt to overturn the election. Key changes include clarifying that the Vice President's role is purely ministerial, raising the threshold for congressional objections from 1 member to 1/5 of each chamber, and affirming that governors must certify electors according to state law.
            </div>
        </div>
    </main>

    <!-- Event Detail Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <div>
                    <div class="modal-date" id="modalDate"></div>
                    <h3 class="modal-title" id="modalTitle"></h3>
                </div>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // ============================================
        // DATA: Election Timeline Events
        // ============================================
        
        // Event categories (lanes) for visualization
        const LANES = {
            official: { id: 'official', label: 'Official Deadlines', color: '#2a9d8f', order: 0 },
            legal: { id: 'legal', label: 'Legal Challenges', color: '#4a9eff', order: 1 },
            political: { id: 'political', label: 'Political/Institutional', color: '#d4a84b', order: 2 },
            pressure: { id: 'pressure', label: 'Pressure Campaigns', color: '#f4a261', order: 3 },
            violence: { id: 'violence', label: 'Violence & Threats', color: '#e63946', order: 4 }
        };

        const electionData = {
            2020: {
                startDate: new Date('2020-03-01'),
                endDate: new Date('2021-01-21'),
                events: [
                    // ========== OFFICIAL/PROCEDURAL EVENTS ==========
                    {
                        id: 'election-day-2020',
                        date: new Date('2020-11-03'),
                        title: 'Election Day',
                        description: 'Voters cast ballots across all 50 states and territories. Due to COVID-19, record numbers vote by mail.',
                        type: 'official',
                        phase: 'election',
                        lane: 'official',
                        details: 'November 3, 2020 saw unprecedented voter turnout of approximately 159 million voters (66.7% of eligible voters). The COVID-19 pandemic led to a massive expansion of mail-in voting, with over 65 million ballots cast by mail.'
                    },
                    {
                        id: 'safe-harbor-2020',
                        date: new Date('2020-12-08'),
                        title: 'Safe Harbor Deadline',
                        description: 'States must resolve disputes and certify results by this date to guarantee Congress accepts their electors.',
                        type: 'official',
                        phase: 'certification',
                        lane: 'official',
                        details: 'Under the Electoral Count Act of 1887, if a state certifies its results at least 6 days before the Electoral College meets, Congress must accept those results as "conclusive." All 50 states met this deadline in 2020.'
                    },
                    {
                        id: 'electoral-college-2020',
                        date: new Date('2020-12-14'),
                        title: 'Electoral College Vote',
                        description: 'Electors meet in state capitals to cast votes. Biden receives 306 electoral votes, Trump receives 232.',
                        type: 'official',
                        phase: 'electoral',
                        lane: 'official',
                        details: 'On the first Monday after the second Wednesday in December, presidential electors convene in their state capitals to cast their ballots. The votes are then transmitted to Congress for the official count.'
                    },
                    {
                        id: 'congress-count-2020',
                        date: new Date('2021-01-06'),
                        title: 'Joint Session of Congress',
                        description: 'Congress meets to count electoral votes. Vice President presides over the session.',
                        type: 'official',
                        phase: 'congress',
                        lane: 'official',
                        details: 'The 12th Amendment and Electoral Count Act establish that Congress meets in joint session on January 6 to count electoral votes, with the Vice President presiding. Members may object to state results, triggering separate votes in each chamber.'
                    },
                    {
                        id: 'inauguration-2020',
                        date: new Date('2021-01-20'),
                        title: 'Inauguration Day',
                        description: '20th Amendment: Presidential term ends at noon. Biden inaugurated as 46th President.',
                        type: 'official',
                        phase: 'transition',
                        lane: 'official',
                        details: 'The 20th Amendment specifies that the outgoing president\'s term ends at exactly noon on January 20. This is a constitutional hard stop—the new president\'s term begins automatically at this moment regardless of whether an oath has been administered.'
                    },

                    // ========== CRISIS EVENTS: PRE-ELECTION ==========
                    {
                        id: 'crisis-mail-voting',
                        date: new Date('2020-03-30'),
                        title: 'Trump Attacks Mail-In Voting',
                        description: 'Trump begins campaign against mail-in voting, calling it "fraudulent" despite evidence to the contrary.',
                        type: 'crisis',
                        phase: 'pre',
                        lane: 'political',
                        connections: ['crisis-2am-speech'],
                        details: 'As COVID-19 spread and states expanded mail voting, Trump tweeted on March 30: "Republicans should fight very hard when it comes to state wide mail-in voting." This began a sustained campaign to delegitimize mail ballots, which would later be used to challenge results.'
                    },
                    {
                        id: 'crisis-wont-accept',
                        date: new Date('2020-07-19'),
                        title: '"I\'ll Have to See" on Results',
                        description: 'Trump refuses to commit to accepting election results in Fox News interview.',
                        type: 'crisis',
                        phase: 'pre',
                        lane: 'political',
                        details: 'Asked by Chris Wallace if he would accept the election results, Trump said "I have to see. Look, I have to see. No, I\'m not going to just say yes." This was the first time a sitting president publicly refused to commit to a peaceful transfer of power.'
                    },
                    {
                        id: 'crisis-delay-election',
                        date: new Date('2020-07-30'),
                        title: 'Suggests Delaying Election',
                        description: 'Trump tweets suggesting the election should be delayed, citing mail-in voting concerns.',
                        type: 'crisis',
                        phase: 'pre',
                        lane: 'political',
                        details: 'Trump tweeted: "Delay the Election until people can properly, securely and safely vote???" No president has the power to delay a federal election—the date is set by Congress. The suggestion was widely condemned by both parties.'
                    },
                    {
                        id: 'crisis-usps-dejoy',
                        date: new Date('2020-08-13'),
                        title: 'DeJoy USPS Changes',
                        description: 'New Postmaster General removes sorting machines, limits overtime, raising mail slowdown concerns.',
                        type: 'crisis',
                        phase: 'pre',
                        lane: 'political',
                        connections: ['crisis-usps-admits'],
                        details: 'Postmaster General Louis DeJoy, a major Trump donor appointed in May, implemented operational changes that removed 671 high-speed mail sorting machines and reduced overtime. Critics warned this would delay mail ballots. Multiple states sued to block the changes.'
                    },
                    {
                        id: 'crisis-usps-admits',
                        date: new Date('2020-08-17'),
                        title: 'Trump Admits USPS Strategy',
                        description: 'Trump says blocking USPS funding prevents mail-in voting from working.',
                        type: 'crisis',
                        phase: 'pre',
                        lane: 'political',
                        details: 'In a Fox Business interview, Trump said he opposed USPS funding because "they need that money in order to have the post office work so it can take all of these millions and millions of ballots." He later denied blocking funding but continued opposing emergency USPS funds.'
                    },
                    {
                        id: 'crisis-get-rid-ballots',
                        date: new Date('2020-09-23'),
                        title: '"Get Rid of the Ballots"',
                        description: 'Trump refuses to commit to peaceful transfer, says "get rid of the ballots" for smooth transition.',
                        type: 'crisis',
                        phase: 'pre',
                        lane: 'political',
                        details: 'Asked if he would commit to a peaceful transfer of power, Trump said: "We\'re going to have to see what happens... Get rid of the ballots and you\'ll have a very peaceful—there won\'t be a transfer, frankly. There will be a continuation."'
                    },
                    {
                        id: 'crisis-stand-by',
                        date: new Date('2020-09-29'),
                        title: '"Stand Back and Stand By"',
                        description: 'At first debate, Trump tells Proud Boys to "stand back and stand by" when asked to condemn white supremacists.',
                        type: 'crisis',
                        phase: 'pre',
                        lane: 'violence',
                        connections: ['crisis-be-wild', 'crisis-jan6-attack'],
                        details: 'When moderator Chris Wallace asked Trump to condemn white supremacist groups, Trump said "Proud Boys, stand back and stand by." The Proud Boys immediately adopted "Stand Back, Stand By" as a slogan. Many members later participated in the January 6 attack.'
                    },

                    // ========== CRISIS EVENTS: ELECTION & POST-ELECTION ==========
                    {
                        id: 'crisis-2am-speech',
                        date: new Date('2020-11-04'),
                        title: '"Frankly, We Did Win"',
                        description: 'At 2:30 AM, with votes still being counted, Trump falsely claims victory and alleges fraud.',
                        type: 'crisis',
                        phase: 'election',
                        lane: 'political',
                        connections: ['crisis-lawsuit-blitz'],
                        details: 'In an early morning White House speech, Trump declared "Frankly, we did win this election" while millions of legitimate mail-in ballots remained uncounted. He called counting these votes "a fraud on the American public" and demanded vote counting stop.'
                    },
                    {
                        id: 'crisis-networks-call',
                        date: new Date('2020-11-07'),
                        title: 'Networks Call Race for Biden',
                        description: 'Major networks project Biden wins Pennsylvania and the presidency. Trump refuses to concede.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'political',
                        details: 'On Saturday, November 7, AP, CNN, NBC, ABC, CBS, and Fox News all projected Biden as the winner. Rather than conceding, Trump tweeted "I WON THIS ELECTION, BY A LOT!" and his campaign filed dozens of lawsuits challenging results.'
                    },
                    {
                        id: 'crisis-fires-esper',
                        date: new Date('2020-11-09'),
                        title: 'Trump Fires Defense Secretary',
                        description: 'Trump fires Defense Secretary Mark Esper, replacing him with a loyalist.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'political',
                        connections: ['crisis-defense-letter'],
                        details: 'Trump fired Defense Secretary Mark Esper via tweet, installing loyalist Christopher Miller. Esper had opposed using active-duty military against protesters. The firing raised concerns about potential misuse of military during the transition.'
                    },
                    {
                        id: 'crisis-gsa-blocks',
                        date: new Date('2020-11-09'),
                        title: 'GSA Blocks Transition',
                        description: 'GSA Administrator Emily Murphy refuses to "ascertain" Biden\'s win, blocking official transition.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'political',
                        details: 'GSA Administrator Emily Murphy refused to sign the official "ascertainment" letter recognizing Biden as president-elect, blocking the transition team from accessing federal agencies, office space, and $6.3 million in transition funds. This lasted until November 23.'
                    },
                    {
                        id: 'crisis-lawsuit-blitz',
                        date: new Date('2020-11-10'),
                        title: 'Lawsuit Blitz Begins',
                        description: 'Trump campaign files dozens of lawsuits in swing states challenging vote counts and procedures.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'legal',
                        connections: ['crisis-sharpie', 'crisis-michigan-canvassers', 'crisis-pa-hearing', 'crisis-texas-scotus'],
                        details: 'The Trump campaign and allies filed over 60 lawsuits in swing states. The suits alleged various irregularities but presented little evidence. Courts—including judges appointed by Trump—dismissed nearly all cases, often with harsh criticism of the lack of evidence.'
                    },
                    {
                        id: 'crisis-sharpie',
                        date: new Date('2020-11-13'),
                        title: 'Arizona "Sharpie-gate"',
                        description: 'False conspiracy theory claims Sharpie markers invalidated Trump votes in Maricopa County.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'legal',
                        details: 'A viral conspiracy theory alleged that poll workers gave Trump voters Sharpie pens that would invalidate their ballots. Election officials explained that Sharpies were recommended because they dry quickly and don\'t smudge, and tabulation machines read them fine. A lawsuit was quickly dismissed.'
                    },
                    {
                        id: 'crisis-giuliani-presser',
                        date: new Date('2020-11-19'),
                        title: 'Giuliani RNC Press Conference',
                        description: 'Giuliani holds press conference making sweeping fraud claims, with hair dye dripping down face.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'legal',
                        details: 'Rudy Giuliani held a press conference at RNC headquarters alleging a vast conspiracy involving Venezuela, George Soros, and "communist money." The bizarre spectacle included hair dye running down his face. Courts rejected all claims as baseless.'
                    },
                    {
                        id: 'crisis-michigan-canvassers',
                        date: new Date('2020-11-20'),
                        title: 'Michigan Canvassers Pressure',
                        description: 'GOP pressures Wayne County canvassers; two try to rescind certification votes after Trump call.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'pressure',
                        details: 'Two Republican Wayne County canvassers initially refused to certify Detroit results, then agreed after public outcry. After a call with Trump, they tried to rescind their votes—but certification was already complete. Trump invited Michigan GOP legislators to the White House to pressure them.'
                    },
                    {
                        id: 'crisis-pa-hearing',
                        date: new Date('2020-11-25'),
                        title: 'Pennsylvania Legislature "Hearing"',
                        description: 'Giuliani holds unofficial hearing at Gettysburg hotel, spreading false fraud claims.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'legal',
                        details: 'Giuliani organized an unofficial "hearing" at a Gettysburg hotel (not the state capitol), presenting discredited witnesses. Trump called in by phone to repeat fraud claims. Pennsylvania had already certified Biden\'s win. The event had no legal standing.'
                    },
                    {
                        id: 'crisis-barr-no-fraud',
                        date: new Date('2020-12-01'),
                        title: 'Barr: No Widespread Fraud',
                        description: 'Attorney General Bill Barr tells AP the DOJ found no evidence of widespread fraud affecting the outcome.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'political',
                        connections: ['crisis-barr-resigns'],
                        details: 'In a significant break from Trump, AG Barr told the Associated Press: "To date, we have not seen fraud on a scale that could have effected a different outcome in the election." Trump was reportedly furious; Barr resigned three weeks later.'
                    },
                    {
                        id: 'crisis-georgia-video',
                        date: new Date('2020-12-04'),
                        title: 'Georgia "Suitcase" Video',
                        description: 'Viral video falsely claims workers pulled hidden ballots from suitcases in Georgia.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'legal',
                        details: 'A security video was edited to falsely suggest Georgia election workers pulled fraudulent ballots from hidden suitcases. State officials debunked this: the "suitcases" were standard ballot containers, and the full video showed normal procedures. The false claim was repeated at legislative hearings.'
                    },
                    {
                        id: 'crisis-texas-scotus',
                        date: new Date('2020-12-08'),
                        title: 'Texas v. Pennsylvania Filed',
                        description: 'Texas AG Paxton files unprecedented SCOTUS suit to overturn results in 4 swing states.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'legal',
                        connections: ['crisis-scotus-rejects'],
                        details: 'Texas AG Ken Paxton filed a lawsuit directly with the Supreme Court seeking to invalidate election results in Georgia, Michigan, Pennsylvania, and Wisconsin. The unprecedented suit asked SCOTUS to let state legislatures appoint electors instead. 126 House Republicans signed an amicus brief supporting it.'
                    },
                    {
                        id: 'crisis-scotus-rejects',
                        date: new Date('2020-12-11'),
                        title: 'SCOTUS Rejects Texas Suit',
                        description: 'Supreme Court rejects Texas lawsuit for lack of standing. 126 House Republicans had supported it.',
                        type: 'crisis',
                        phase: 'certification',
                        lane: 'legal',
                        details: 'The Supreme Court, including three Trump appointees, rejected the Texas suit in a one-page order, finding Texas had no standing to challenge other states\' elections. Justice Alito, joined by Thomas, said the court should have heard the case but would not have granted relief.'
                    },

                    // ========== CRISIS EVENTS: ELECTORAL COLLEGE PERIOD ==========
                    {
                        id: 'crisis-barr-resigns',
                        date: new Date('2020-12-14'),
                        title: 'AG Barr Resigns',
                        description: 'Attorney General Barr announces resignation, effective December 23, after refusing to support fraud claims.',
                        type: 'crisis',
                        phase: 'electoral',
                        lane: 'political',
                        connections: ['crisis-doj-clark'],
                        details: 'William Barr submitted his resignation letter on December 14, the same day the Electoral College voted. His departure came after he publicly contradicted Trump\'s fraud claims and refused to appoint a special counsel to investigate the election.'
                    },
                    {
                        id: 'crisis-fake-electors',
                        date: new Date('2020-12-14'),
                        title: 'Fake Elector Scheme',
                        description: 'In 7 states Biden won, Trump supporters convene as fake "alternate electors" and sign fraudulent certificates.',
                        type: 'crisis',
                        phase: 'electoral',
                        lane: 'legal',
                        connections: ['crisis-eastman-memo'],
                        details: 'In Arizona, Georgia, Michigan, Nevada, New Mexico, Pennsylvania, and Wisconsin, groups of Trump supporters met and signed certificates falsely claiming to be the state\'s legitimate electors. These fake certificates were sent to Congress and the National Archives as part of the scheme to overturn the election.'
                    },
                    {
                        id: 'crisis-oval-office',
                        date: new Date('2020-12-18'),
                        title: 'Chaotic Oval Office Meeting',
                        description: 'Sidney Powell, Michael Flynn discuss martial law, seizing voting machines at White House meeting.',
                        type: 'crisis',
                        phase: 'electoral',
                        lane: 'pressure',
                        details: 'A chaotic Oval Office meeting included discussion of appointing Sidney Powell as a special counsel to investigate election fraud, using the military to seize voting machines, and invoking martial law. White House counsel and others strenuously objected.'
                    },
                    {
                        id: 'crisis-be-wild',
                        date: new Date('2020-12-19'),
                        title: '"Will Be Wild" Tweet',
                        description: 'Trump tweets about January 6 protest: "Big protest in D.C. on January 6th. Be there, will be wild!"',
                        type: 'crisis',
                        phase: 'electoral',
                        lane: 'violence',
                        connections: ['crisis-jan6-attack'],
                        details: 'Trump\'s tweet served as a call to action for his supporters to come to Washington on January 6. Extremist groups including the Proud Boys and Oath Keepers began planning their response, interpreting "will be wild" as a signal.'
                    },
                    {
                        id: 'crisis-doj-clark',
                        date: new Date('2020-12-28'),
                        title: 'DOJ Clark Pressure Begins',
                        description: 'Trump considers replacing Acting AG with Jeffrey Clark, who would support fraud claims.',
                        type: 'crisis',
                        phase: 'electoral',
                        lane: 'pressure',
                        connections: ['crisis-doj-showdown', 'crisis-oval-showdown'],
                        details: 'Trump began discussing installing Jeffrey Clark, an environmental lawyer at DOJ, as Acting Attorney General. Clark had drafted a letter to Georgia officials falsely claiming DOJ found election irregularities. Acting AG Rosen and Deputy Donoghue refused to send it.'
                    },

                    // ========== CRISIS EVENTS: FINAL DAYS ==========
                    {
                        id: 'crisis-doj-showdown',
                        date: new Date('2021-01-01'),
                        title: 'DOJ Leadership Confrontation',
                        description: 'Acting AG Rosen and Deputy Donoghue warn of mass resignations if Clark is installed.',
                        type: 'crisis',
                        phase: 'congress',
                        lane: 'pressure',
                        connections: ['crisis-oval-showdown'],
                        details: 'In a New Year\'s Day call, Deputy AG Donoghue told Trump that if he installed Clark, "you will lose your entire department leadership." Every assistant AG prepared resignation letters. This set up the dramatic January 3 Oval Office confrontation.'
                    },
                    {
                        id: 'crisis-raffensperger',
                        date: new Date('2021-01-02'),
                        title: 'Trump-Raffensperger Call',
                        description: '"I just want to find 11,780 votes." Trump pressures Georgia Secretary of State to overturn results.',
                        type: 'crisis',
                        phase: 'congress',
                        lane: 'pressure',
                        details: 'In an hour-long call later leaked to the Washington Post, Trump pressured Georgia Secretary of State Brad Raffensperger to "find 11,780 votes"—one more than Biden\'s margin. Raffensperger refused. Trump was later indicted in Georgia for this call.'
                    },
                    {
                        id: 'crisis-defense-letter',
                        date: new Date('2021-01-03'),
                        title: '10 Defense Secretaries Letter',
                        description: 'All 10 living former Defense Secretaries publish unprecedented letter warning military to stay out of election.',
                        type: 'crisis',
                        phase: 'congress',
                        lane: 'political',
                        details: 'An extraordinary open letter signed by all 10 living former Defense Secretaries (including Dick Cheney, Donald Rumsfeld, and James Mattis) warned that "the time for questioning the results has passed" and that military involvement in the transition would be dangerous.'
                    },
                    {
                        id: 'crisis-oval-showdown',
                        date: new Date('2021-01-03'),
                        title: 'Oval Office DOJ Showdown',
                        description: 'In 3-hour meeting, DOJ leadership threatens mass resignation; Trump abandons Clark plan.',
                        type: 'crisis',
                        phase: 'congress',
                        lane: 'pressure',
                        details: 'In a dramatic 3-hour Oval Office meeting, Acting AG Rosen, Deputy Donoghue, and White House Counsel Cipollone confronted Trump about installing Clark. When told the entire DOJ leadership would resign, Trump asked Clark "What do I get from you?" Clark couldn\'t guarantee success, and Trump backed down.'
                    },
                    {
                        id: 'crisis-eastman-memo',
                        date: new Date('2021-01-04'),
                        title: 'Eastman Memo Circulates',
                        description: 'John Eastman memo claims VP Pence can unilaterally reject electoral votes on January 6.',
                        type: 'crisis',
                        phase: 'congress',
                        lane: 'legal',
                        connections: ['crisis-pence-pressure'],
                        details: 'Conservative lawyer John Eastman wrote memos arguing Pence could reject electors from contested states or delay certification. Legal scholars across the political spectrum called this theory baseless. Eastman later acknowledged in writing that his theory would lose 9-0 at SCOTUS.'
                    },
                    {
                        id: 'crisis-pence-pressure',
                        date: new Date('2021-01-05'),
                        title: 'Pence Pressure Intensifies',
                        description: 'Trump demands Pence reject electors; Pence\'s counsel concludes he has no such power.',
                        type: 'crisis',
                        phase: 'congress',
                        lane: 'pressure',
                        connections: ['crisis-jan6-attack'],
                        details: 'On January 5, Trump met with Pence and continued demanding he reject electoral votes. Pence\'s counsel Greg Jacob and outside advisors concluded Pence had no such constitutional authority. At the January 5 rally, Trump told crowds Pence could still do "the right thing."'
                    },
                    {
                        id: 'crisis-jan6-attack',
                        date: new Date('2021-01-06'),
                        title: 'Capitol Attack',
                        description: 'After Trump rally, mob storms Capitol to stop electoral count. 5 deaths, 140+ police injured.',
                        type: 'crisis',
                        phase: 'congress',
                        lane: 'violence',
                        connections: ['crisis-certification', 'crisis-twitter-ban', 'crisis-impeachment-2'],
                        details: 'Following a rally where Trump told supporters to "fight like hell" and march to the Capitol, a mob breached the building, forcing Congress to evacuate. The attack resulted in 5 deaths, 140+ injured officers, and delayed the electoral count for hours. It was the worst attack on the Capitol since the War of 1812.'
                    },
                    {
                        id: 'crisis-certification',
                        date: new Date('2021-01-07'),
                        title: 'Congress Certifies at 3:44 AM',
                        description: 'After Capitol is secured, Congress reconvenes and certifies Biden\'s victory early in the morning.',
                        type: 'crisis',
                        phase: 'congress',
                        lane: 'official',
                        details: 'After the Capitol was secured, Congress reconvened around 8 PM and completed the electoral count at 3:44 AM on January 7. Despite the attack, 147 Republican members still voted to object to results in Arizona and/or Pennsylvania.'
                    },
                    {
                        id: 'crisis-twitter-ban',
                        date: new Date('2021-01-08'),
                        title: 'Twitter Bans Trump',
                        description: 'Twitter permanently suspends Trump\'s account citing risk of further incitement of violence.',
                        type: 'crisis',
                        phase: 'congress',
                        lane: 'political',
                        details: 'Twitter permanently suspended @realDonaldTrump, stating: "After close review of recent Tweets from the @realDonaldTrump account and the context around them...we have permanently suspended the account due to the risk of further incitement of violence." Facebook and other platforms followed.'
                    },
                    {
                        id: 'crisis-impeachment-2',
                        date: new Date('2021-01-13'),
                        title: 'Second Impeachment',
                        description: 'House impeaches Trump for "incitement of insurrection" 232-197, with 10 Republicans voting yes.',
                        type: 'crisis',
                        phase: 'congress',
                        lane: 'legal',
                        details: 'The House impeached Trump for a second time, charging him with "incitement of insurrection." The vote was 232-197, with 10 Republicans joining all Democrats. It was the most bipartisan impeachment in U.S. history. The Senate trial occurred after Trump left office; he was acquitted 57-43.'
                    },
                    {
                        id: 'crisis-skip-inauguration',
                        date: new Date('2021-01-19'),
                        title: 'Trump Refuses Inauguration',
                        description: 'Trump becomes first president since 1869 to skip successor\'s inauguration, leaves D.C. early.',
                        type: 'crisis',
                        phase: 'transition',
                        lane: 'political',
                        details: 'Breaking 152 years of tradition, Trump refused to attend Biden\'s inauguration—the first president since Andrew Johnson (1869) to skip the ceremony. He left Washington early on January 20 for Mar-a-Lago, holding his own departure ceremony at Joint Base Andrews.'
                    }
                ]
            },
            2028: {
                startDate: new Date('2028-09-01'),
                endDate: new Date('2029-01-21'),
                events: [
                    // Official/Procedural Events with ECRA reforms
                    {
                        id: 'election-day-2028',
                        date: new Date('2028-11-07'),
                        title: 'Election Day',
                        description: 'First Tuesday after first Monday in November. Voters cast ballots nationwide.',
                        type: 'official',
                        phase: 'election',
                        lane: 'official',
                        details: 'Election Day 2028 falls on November 7. States will have varying early voting periods and mail ballot deadlines according to state law.'
                    },
                    {
                        id: 'safe-harbor-2028',
                        date: new Date('2028-12-13'),
                        title: 'Safe Harbor Deadline',
                        description: 'ECRA 2022: States must certify results 6 days before Electoral College meets.',
                        type: 'official',
                        phase: 'certification',
                        lane: 'official',
                        details: 'Under the Electoral Count Reform Act of 2022, the safe harbor deadline remains 6 days before electors meet. States completing certification by this date have their results protected from congressional challenge.'
                    },
                    {
                        id: 'electoral-college-2028',
                        date: new Date('2028-12-19'),
                        title: 'Electoral College Vote',
                        description: 'First Tuesday after the second Wednesday in December. Electors meet in state capitals.',
                        type: 'official',
                        phase: 'electoral',
                        lane: 'official',
                        details: 'Electors convene in their respective state capitals to cast their votes for President and Vice President. Results are transmitted to Congress.'
                    },
                    {
                        id: 'congress-count-2028',
                        date: new Date('2029-01-06'),
                        title: 'Joint Session of Congress',
                        description: 'ECRA 2022: VP role is "solely ministerial." Objections require 1/5 of each chamber.',
                        type: 'official',
                        phase: 'congress',
                        lane: 'official',
                        details: 'The Electoral Count Reform Act of 2022 made critical changes to this process: (1) The Vice President\'s role is explicitly "solely ministerial"—they cannot reject or delay electoral votes; (2) Objections now require signatures from 1/5 of each chamber (previously just 1 member); (3) Grounds for objection are limited to whether electors were "lawfully certified" or whether votes were "regularly given."'
                    },
                    {
                        id: 'inauguration-2028',
                        date: new Date('2029-01-20'),
                        title: 'Inauguration Day',
                        description: '20th Amendment: Presidential term ends at noon regardless of circumstances.',
                        type: 'official',
                        phase: 'transition',
                        lane: 'official',
                        details: 'Per the 20th Amendment, the outgoing president\'s term ends at exactly noon on January 20, 2029. This constitutional deadline is absolute and self-executing.'
                    },

                    // ECRA Reform markers
                    {
                        id: 'reform-vp-role',
                        date: new Date('2029-01-06'),
                        title: 'ECRA: VP Role Clarified',
                        description: 'Post-2020 reform: Vice President\'s role is now explicitly "solely ministerial."',
                        type: 'reform',
                        phase: 'congress',
                        lane: 'legal',
                        details: 'The Electoral Count Reform Act of 2022 explicitly states the Vice President "shall have no power to solely determine, accept, reject, or otherwise adjudicate or resolve disputes over the proper list of electors." This closes the loophole the Trump campaign tried to exploit by pressuring Pence.'
                    },
                    {
                        id: 'reform-objection-threshold',
                        date: new Date('2029-01-06'),
                        title: 'ECRA: Higher Objection Threshold',
                        description: 'Post-2020 reform: Objections now require 1/5 of each chamber, not just one member.',
                        type: 'reform',
                        phase: 'congress',
                        lane: 'legal',
                        details: 'Under the old Electoral Count Act of 1887, a single member from each chamber could force a vote on objections. The ECRA raises this to 1/5 of each chamber (87 House members, 20 Senators), making frivolous objections much harder to sustain.'
                    },
                    {
                        id: 'reform-governor-cert',
                        date: new Date('2028-12-13'),
                        title: 'ECRA: Governor Certification',
                        description: 'Post-2020 reform: Only the Governor can certify electors, per state law.',
                        type: 'reform',
                        phase: 'certification',
                        lane: 'legal',
                        details: 'The ECRA establishes that each state\'s Governor is the sole official who can submit the "certificate of ascertainment" identifying the state\'s electors. This prevents scenarios where competing officials (like state legislatures) might try to submit alternate slates.'
                    }
                ]
            }
        };

        // ============================================
        // APPLICATION STATE
        // ============================================

        let state = {
            selectedYear: 2020,
            showCrisis: false,
            showConnections: false,
            zoomLevel: 100,
            selectedPhase: 'all'
        };

        // Lane configuration
        const LANE_POSITIONS = {
            official: 0,
            legal: 100,
            political: 200,
            pressure: 300,
            violence: 400
        };

        const LANE_HEIGHT = 100;

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function formatDate(date) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                           'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
        }

        function daysBetween(date1, date2) {
            return Math.round((date2 - date1) / (1000 * 60 * 60 * 24));
        }

        function getPositionForDate(date, startDate, endDate, containerWidth) {
            const totalDays = daysBetween(startDate, endDate);
            const daysFromStart = daysBetween(startDate, date);
            const padding = 100; // pixels of padding on each side
            const usableWidth = containerWidth - (padding * 2);
            return padding + (daysFromStart / totalDays) * usableWidth;
        }

        // ============================================
        // RENDERING FUNCTIONS
        // ============================================

        function renderTimeline() {
            const container = document.getElementById('timeline');
            const data = electionData[state.selectedYear];

            // Calculate container width based on zoom
            const baseWidth = Math.max(1400, window.innerWidth - 100);
            const containerWidth = baseWidth * (state.zoomLevel / 100);
            container.style.width = `${containerWidth}px`;

            // Clear existing elements
            container.querySelectorAll('.timeline-event, .lane-tracks, .lane-label, .connections-layer').forEach(el => el.remove());

            // Render lane tracks and labels
            renderLaneTracks(container);

            // Render date markers
            renderDateMarkers(data.startDate, data.endDate, containerWidth);

            // Filter events by phase
            let events = data.events;
            if (state.selectedPhase !== 'all') {
                events = events.filter(e => e.phase === state.selectedPhase);
            }

            // Sort events by date
            events.sort((a, b) => a.date - b.date);

            // Calculate positions and detect collisions
            const eventPositions = calculateEventPositions(events, data.startDate, data.endDate, containerWidth);

            // Render events
            eventPositions.forEach(({ event, x, offsetClass }) => {
                const eventEl = document.createElement('div');
                eventEl.className = `timeline-event ${event.type}`;
                if (offsetClass) eventEl.classList.add(offsetClass);
                eventEl.setAttribute('data-lane', event.lane);
                eventEl.setAttribute('data-id', event.id);
                eventEl.style.left = `${x}px`;

                const hasConnections = event.connections && event.connections.length > 0;

                eventEl.innerHTML = `
                    <div class="event-dot ${hasConnections ? 'has-connections' : ''}"></div>
                    <div class="event-content">
                        <div class="event-date">${formatDate(event.date)}</div>
                        <div class="event-title">${event.title}</div>
                    </div>
                `;

                eventEl.addEventListener('click', () => openModal(event));
                eventEl.addEventListener('mouseenter', () => highlightConnections(event));
                eventEl.addEventListener('mouseleave', () => clearConnectionHighlights());

                container.appendChild(eventEl);
            });

            // Render connection lines
            if (state.showCrisis) {
                renderConnections(container, events, eventPositions, data.startDate, data.endDate, containerWidth);
            }

            // Update visibility classes
            container.classList.toggle('show-crisis', state.showCrisis);
            container.classList.toggle('show-connections', state.showConnections);

            // Update info panel
            updateInfoPanel();
        }

        function renderLaneTracks(container) {
            // Lane tracks container
            const tracksContainer = document.createElement('div');
            tracksContainer.className = 'lane-tracks';

            Object.keys(LANES).forEach(laneId => {
                const track = document.createElement('div');
                track.className = `lane-track ${laneId}`;
                tracksContainer.appendChild(track);
            });

            container.appendChild(tracksContainer);

            // Lane labels
            Object.entries(LANES).forEach(([id, lane]) => {
                const label = document.createElement('div');
                label.className = `lane-label ${id}`;
                label.textContent = lane.label;
                container.appendChild(label);
            });
        }

        function calculateEventPositions(events, startDate, endDate, containerWidth) {
            const positions = [];
            const laneOccupancy = {}; // Track occupied x positions per lane

            Object.keys(LANES).forEach(lane => {
                laneOccupancy[lane] = [];
            });

            events.forEach(event => {
                const x = getPositionForDate(event.date, startDate, endDate, containerWidth);
                const lane = event.lane || 'political';

                // Check for collisions in this lane
                let offsetClass = null;
                const minSpacing = 100 * (state.zoomLevel / 100); // Minimum pixels between events

                const nearbyEvents = laneOccupancy[lane].filter(pos => Math.abs(pos.x - x) < minSpacing);

                if (nearbyEvents.length > 0) {
                    // Assign offset class based on collision count
                    const offsetIndex = nearbyEvents.length % 4;
                    offsetClass = `offset-${offsetIndex + 1}`;
                }

                laneOccupancy[lane].push({ x, event });
                positions.push({ event, x, offsetClass });
            });

            return positions;
        }

        function renderConnections(container, events, eventPositions, startDate, endDate, containerWidth) {
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.classList.add('connections-layer');
            svg.setAttribute('width', '100%');
            svg.setAttribute('height', '100%');
            svg.style.width = `${containerWidth}px`;

            // Build position lookup
            const positionLookup = {};
            eventPositions.forEach(({ event, x }) => {
                const laneY = 60 + (LANE_POSITIONS[event.lane] || 0) + 7; // Center of dot
                positionLookup[event.id] = { x, y: laneY };
            });

            // Draw connections
            events.forEach(event => {
                if (!event.connections) return;

                event.connections.forEach(targetId => {
                    const sourcePos = positionLookup[event.id];
                    const targetPos = positionLookup[targetId];

                    if (!sourcePos || !targetPos) return;

                    // Determine connection chain type based on lane
                    let chainClass = 'political-chain';
                    if (event.lane === 'legal') chainClass = 'legal-chain';
                    else if (event.lane === 'pressure') chainClass = 'pressure-chain';
                    else if (event.lane === 'violence') chainClass = 'violence-chain';

                    // Create curved path
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const midX = (sourcePos.x + targetPos.x) / 2;
                    const controlY = Math.min(sourcePos.y, targetPos.y) - 30;

                    path.setAttribute('d', `M ${sourcePos.x} ${sourcePos.y} Q ${midX} ${controlY} ${targetPos.x} ${targetPos.y}`);
                    path.classList.add('connection-line', chainClass);
                    path.setAttribute('data-source', event.id);
                    path.setAttribute('data-target', targetId);

                    svg.appendChild(path);
                });
            });

            container.insertBefore(svg, container.firstChild);
        }

        function highlightConnections(event) {
            if (!state.showConnections) return;

            // Highlight connections from this event
            document.querySelectorAll('.connection-line').forEach(line => {
                const source = line.getAttribute('data-source');
                const target = line.getAttribute('data-target');

                if (source === event.id || target === event.id) {
                    line.classList.add('highlighted');
                }
            });

            // Highlight connected events
            if (event.connections) {
                event.connections.forEach(targetId => {
                    const targetEl = document.querySelector(`[data-id="${targetId}"]`);
                    if (targetEl) targetEl.classList.add('highlighted');
                });
            }
        }

        function clearConnectionHighlights() {
            document.querySelectorAll('.connection-line.highlighted, .timeline-event.highlighted').forEach(el => {
                el.classList.remove('highlighted');
            });
        }
        
        function renderDateMarkers(startDate, endDate, containerWidth) {
            const markersContainer = document.getElementById('dateMarkers');
            markersContainer.innerHTML = '';
            markersContainer.style.width = `${containerWidth}px`;
            
            const totalDays = daysBetween(startDate, endDate);
            
            // Determine marker interval based on total days and zoom
            let intervalDays;
            if (totalDays > 200) {
                intervalDays = state.zoomLevel < 150 ? 30 : 14;
            } else {
                intervalDays = state.zoomLevel < 150 ? 14 : 7;
            }
            
            // Generate markers
            const currentDate = new Date(startDate);
            currentDate.setDate(1); // Start at beginning of month
            
            while (currentDate <= endDate) {
                const x = getPositionForDate(currentDate, startDate, endDate, containerWidth);
                
                if (x >= 50 && x <= containerWidth - 50) {
                    const marker = document.createElement('div');
                    marker.className = 'date-marker';
                    marker.style.left = `${x}px`;
                    
                    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                                   'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    const label = currentDate.getDate() === 1 
                        ? `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`
                        : `${months[currentDate.getMonth()]} ${currentDate.getDate()}`;
                    
                    marker.innerHTML = `
                        <div class="date-marker-line"></div>
                        <div class="date-marker-label">${label}</div>
                    `;
                    
                    markersContainer.appendChild(marker);
                }
                
                currentDate.setDate(currentDate.getDate() + intervalDays);
            }
        }
        
        function updateInfoPanel() {
            const reformNote = document.getElementById('reformNote');
            if (state.selectedYear === 2028) {
                reformNote.style.display = 'block';
            } else {
                reformNote.style.display = 'none';
            }
        }

        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        
        function openModal(event) {
            const overlay = document.getElementById('modalOverlay');
            const dateEl = document.getElementById('modalDate');
            const titleEl = document.getElementById('modalTitle');
            const bodyEl = document.getElementById('modalBody');

            dateEl.textContent = formatDate(event.date);
            titleEl.textContent = event.title;

            // Type tag
            let typeTagClass = event.type;
            let typeTagLabel = event.type.charAt(0).toUpperCase() + event.type.slice(1);
            if (event.type === 'official') typeTagLabel = 'Official Deadline';
            if (event.type === 'crisis') typeTagLabel = '2020 Crisis Event';
            if (event.type === 'reform') typeTagLabel = 'ECRA 2022 Reform';

            // Lane tag
            const lane = event.lane || 'political';
            const laneInfo = LANES[lane];
            const laneLabel = laneInfo ? laneInfo.label : lane;

            // Connection info
            let connectionHtml = '';
            if (event.connections && event.connections.length > 0) {
                const connectedEvents = event.connections.map(id => {
                    const found = electionData[state.selectedYear].events.find(e => e.id === id);
                    return found ? found.title : id;
                });
                connectionHtml = `<p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 1rem;"><strong>Connects to:</strong> ${connectedEvents.join(', ')}</p>`;
            }

            bodyEl.innerHTML = `
                <p>${event.details}</p>
                ${connectionHtml}
                <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <span class="modal-tag ${typeTagClass}">${typeTagLabel}</span>
                    <span class="modal-tag ${lane}">${laneLabel}</span>
                </div>
            `;

            overlay.classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================
        
        function initEventHandlers() {
            // Year toggle
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    state.selectedYear = parseInt(e.target.dataset.year);
                    
                    // Reset crisis view when switching years
                    if (state.selectedYear === 2028) {
                        state.showCrisis = false;
                        document.getElementById('crisisToggle').classList.remove('active');
                    }
                    
                    renderTimeline();
                });
            });
            
            // Crisis toggle
            document.getElementById('crisisToggle').addEventListener('click', (e) => {
                state.showCrisis = !state.showCrisis;
                e.target.classList.toggle('active');
                e.target.textContent = state.showCrisis ? 'Hide 2020 Crisis Events' : 'Show 2020 Crisis Events';
                renderTimeline();
            });

            // Connections toggle
            document.getElementById('connectionsToggle').addEventListener('click', (e) => {
                state.showConnections = !state.showConnections;
                e.target.classList.toggle('active');
                e.target.textContent = state.showConnections ? 'Hide Connections' : 'Show Connections';
                const container = document.getElementById('timeline');
                container.classList.toggle('show-connections', state.showConnections);
            });
            
            // Zoom controls
            document.getElementById('zoomIn').addEventListener('click', () => {
                if (state.zoomLevel < 300) {
                    state.zoomLevel += 25;
                    document.getElementById('zoomLevel').textContent = `${state.zoomLevel}%`;
                    renderTimeline();
                }
            });
            
            document.getElementById('zoomOut').addEventListener('click', () => {
                if (state.zoomLevel > 50) {
                    state.zoomLevel -= 25;
                    document.getElementById('zoomLevel').textContent = `${state.zoomLevel}%`;
                    renderTimeline();
                }
            });
            
            // Phase filter
            document.querySelectorAll('.phase-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.phase-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    state.selectedPhase = e.target.dataset.phase;
                    renderTimeline();
                });
            });
            
            // Modal close
            document.getElementById('modalClose').addEventListener('click', closeModal);
            document.getElementById('modalOverlay').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) closeModal();
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeModal();
            });
            
            // Window resize
            window.addEventListener('resize', () => {
                renderTimeline();
            });
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', () => {
            initEventHandlers();
            renderTimeline();
        });
    </script>
</body>
</html>
